<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Insider Trading Insights</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #f3f4f6, #ffffff);
      color: #333;
      margin: 0 auto;
      max-width: 900px;
      padding: 2rem;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-weight: 600;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: 500;
    }
    input[type="text"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 0.95rem;
      transition: border-color 0.3s ease;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      background: #2563eb;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #1e3a8a;
    }
    .section {
      margin-top: 30px;
      padding: 20px;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      background-color: #f9fafb;
    }
    .section h2 {
      margin-bottom: 10px;
      font-weight: 600;
    }
    #loading {
      margin-top: 10px;
      font-style: italic;
      color: #f97316;
      display: none;
    }
    /* Container for picks */
    .picksContainer {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .pickItem {
      background-color: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 4px;
      padding: 8px 16px;
      margin-bottom: 8px;
      cursor: pointer;
    }
    .pickItem:hover {
      background-color: #f3f3f3;
    }
    .bullish {
      color: green;
    }
    .bearish {
      color: red;
    }
  </style>
</head>
<body>

  <!-- Optional Back Button, if desired -->
  <button onclick="window.location.href='https://www.projectmanagerhelper.com'">
    Back to Main Page
  </button>

  <h1>Insider Trading Insights</h1>
  <p>
    Enter a ticker symbol (e.g., IBM) to retrieve insider trading data from Alpha Vantage. 
    We split them into acquisitions (bullish) vs disposals (bearish).
  </p>

  <label for="ticker">Ticker Symbol:</label>
  <input type="text" id="ticker" placeholder="e.g. IBM" />

  <button id="insiderButton">Get Insider Data</button>
  <div id="loading">Loading insider data...</div>

  <!-- Bullish Section -->
  <div id="bullishSection" class="section" style="display:none;">
    <h2>Bullish (Acquisitions)</h2>
    <div id="bullishContainer" class="picksContainer"></div>
  </div>

  <!-- Bearish Section -->
  <div id="bearishSection" class="section" style="display:none;">
    <h2>Bearish (Disposals)</h2>
    <div id="bearishContainer" class="picksContainer"></div>
  </div>

  <!-- Summary Section -->
  <div id="summarySection" class="section" style="display:none;">
    <h2>Transaction Details</h2>
    <div id="summary"></div>
  </div>

  <script>
    document.getElementById('insiderButton').addEventListener('click', async () => {
      const ticker = document.getElementById('ticker').value.trim();
      if (!ticker) {
        alert("Please enter a ticker symbol first.");
        return;
      }

      // Show loading
      const loadingEl = document.getElementById('loading');
      loadingEl.style.display = 'block';

      // Hide sections
      document.getElementById('bullishSection').style.display = 'none';
      document.getElementById('bearishSection').style.display = 'none';
      document.getElementById('summarySection').style.display = 'none';
      document.getElementById('summary').innerHTML = '';

      try {
        // Build the /api/insider endpoint (Next.js style)
        const url = `/api/insider?symbol=${encodeURIComponent(ticker)}`;
        console.log("Fetching from:", url);

        const response = await fetch(url);
        if (!response.ok) {
          throw new Error("Failed to fetch insider data. Status: " + response.status);
        }
        const data = await response.json();

        // Data should contain data.data array
        if (!data.data || !Array.isArray(data.data)) {
          throw new Error("Invalid insider data format.");
        }

        // Separate acquisitions (A) from disposals (D)
        const acquisitions = data.data.filter(item => item.acquisition_or_disposal === 'A');
        const disposals = data.data.filter(item => item.acquisition_or_disposal === 'D');

        // Display them
        showPicks(acquisitions, 'bullishSection', 'bullishContainer', true);
        showPicks(disposals, 'bearishSection', 'bearishContainer', false);

      } catch (err) {
        console.error("Error retrieving insider data:", err);
        alert("Error: " + err.message);
      } finally {
        loadingEl.style.display = 'none';
      }
    });

    function showPicks(pickArray, sectionId, containerId, isBullish) {
      const section = document.getElementById(sectionId);
      const container = document.getElementById(containerId);
      container.innerHTML = '';

      if (pickArray.length === 0) {
        // If no data, hide section
        section.style.display = 'none';
        return;
      }

      section.style.display = 'block';
      pickArray.forEach((item, idx) => {
        const div = document.createElement('div');
        div.className = 'pickItem';
        // Add color
        div.classList.add(isBullish ? 'bullish' : 'bearish');

        // Show ticker, shares, date
        div.innerHTML = `<strong>${item.ticker}</strong> - ${parseFloat(item.shares).toLocaleString()} shares on ${item.transaction_date}`;
        // On click, show summary
        div.addEventListener('click', () => showSummary(item, idx + 1, isBullish));
        container.appendChild(div);
      });
    }

    function showSummary(item, rank, isBullish) {
      document.getElementById('summarySection').style.display = 'block';
      const summaryEl = document.getElementById('summary');
      // Build a small detail table or list
      let html = `<p><strong>Pick #${rank}: ${item.ticker}</strong> (${isBullish ? 'Acquisition' : 'Disposal'})</p>`;
      html += `<ul>`;
      html += `<li>Transaction Date: ${item.transaction_date}</li>`;
      html += `<li>Executive: ${item.executive}</li>`;
      html += `<li>Title: ${item.executive_title}</li>`;
      html += `<li>Security Type: ${item.security_type}</li>`;
      html += `<li>Shares: ${parseFloat(item.shares).toLocaleString()}</li>`;
      html += `<li>Share Price: $${parseFloat(item.share_price).toFixed(2)}</li>`;
      html += `</ul>`;

      summaryEl.innerHTML = html;
      summaryEl.scrollIntoView({ behavior: 'smooth' });
    }
  </script>
</body>
</html>
